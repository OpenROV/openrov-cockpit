<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../orov-behaviors/orov-behavior.html">
<dom-module name="orov-blackbox">
  <style>
  </style>
  <template>
    <lable>{{__('Black Box Controls')}}</label>
    <button on-click='start'>{{__('Start')}}</button>
    <button on-click='stop'>{{__('Stop')}}</button>
    <paper-dropdown-menu label="{{__('Choose format:')}}">
      <paper-menu class="dropdown-content" selected="{{format}}">
        <paper-item>{{__('csv')}}</paper-item>
        <paper-item>{{__('json')}}</paper-item>
        <paper-item>{{__('xml')}}</paper-item>
      </paper-menu>
    </paper-dropdown-menu>
    <paper-dropdown-menu label="{{__('Choose Session:')}}">
      <paper-menu class="dropdown-content" selected="{{sessionID}}">
        <template is="dom-repeat" items="{{sessions}}">
          <paper-item>{{item.sessionID}}</paper-item>
        </template>
      </paper-menu>
    </paper-dropdown-menu>
    <button on-click='export'>{{__('Export')}}</button>

  </template>
  <script>
    (function() {
      Polymer({
        is: "orov-blackbox",
        properties: {
          format: {type: String, value: 'csv'},
          sessions: {type: Array},
          session: {type: String}
        },
        behaviors: [namespace('behaviors').oROVStandard],
        registerEmitterHanlders: function(emitter){
          var self=this;
          emitter.withHistory.on('plugin-blackbox-sessions',function(sessions){
            self.sessions = sessions;
            self.session = sessions.length>0?sessions[sessions.length-1].sessionID:'';
          });
        },
        start: function(){
          if(this.eventEmitter !== undefined){
            this.eventEmitter.emit('plugin-blackbox-recording-start');
          }
        },
        stop: function(){
          if(this.eventEmitter !== undefined){
            this.eventEmitter.emit('plugin-blackbox-recording-stop');
          }
        },
        export: function(){
          var options = {collection: '*', format: this.format, sessionID: this.session};
          if(this.eventEmitter !== undefined){
            this.eventEmitter.emit('plugin-blackbox-export',options);
          }
        }
      })
    })();
  </script>

</dom-module>
