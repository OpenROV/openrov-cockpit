<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../orov-behaviors/orov-behavior.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<dom-module name="orov-servo-tilt">
  <style>
    #servoTiltImage {
      width: 30px;
      height: 28px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center center;
      position: relative;
      top: 5px;
      z-index: 1;

      /*Hardware acceleration*/
      translate3d(0,0,0);
      transition-duration: 0.2s;
      transition-timing-function: ease-out;
    }
    
    iron-icon {
      padding-top: 20%;
      padding-bottom: 20%;
    }

    #targetPos {
      width: 6px;
      height: 6px;
      -moz-border-radius: 3px;
      -webkit-border-radius: 3px;
      border-radius: 2px;

      position: relative;
      z-index: 3;

      background: #ffb33b;
      opacity: 1.0;
    }

  </style>
  <template>
    <div style="position: relative; z-index: 1;">
      <!--<img id="servoTiltImage" src="data:image/png;base64,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"/>-->
      <iron-icon id="servoTiltImage"icon="av:videocam"></iron-icon>
      <div id="targetPos"></div>
    </div>
  </template>
  <script>
    
    (function() {
      Polymer({
        is: "orov-servo-tilt",
        properties: {
          defaultPanel:{type:String,value:"warning-display"},
          servoAngle: {
            type: Number,
            value: 0,
            observer: '_servoAngleChanged'
          },
          targetAngle: {
            type: Number,
            value: 0,
            observer: '_targetAngleChanged'
          },
        },
        behaviors: [namespace('behaviors').oROVStandard],
        _servoAngleChanged: function(){
          
          //For some reason, the camera icon rotates opposite to the value we expect. Correct for it here with the negative
          var newvalue='rotate('+ -this.servoAngle +'deg)';
          
          this.$.servoTiltImage.style['-webkit-transform'] = newvalue;
          this.$.servoTiltImage.style['-moz-transform'] = newvalue;
          this.$.servoTiltImage.style['transform'] = newvalue;
        },
        _targetAngleChanged: function(){
          
          var targetAngleRads = this.targetAngle * Math.PI / 180;

          //Empirical because it looks nice and smooth
          var xPos = -7.788*(targetAngleRads*targetAngleRads) - 0.973*targetAngleRads + 31.469;
          var yPos = -19.47*targetAngleRads - 18.667;

          var translateTo = 'translate3d(' + xPos + 'px,' + yPos + 'px,0px)';
          this.$.targetPos.style['transform'] = translateTo;
        },

        ready: function () {
        },
        registerEmitterHandlers: function(emitter){
          var self = this;
          emitter.withHistory.on('plugin.cameraServo.currentPos',function(angle){
            self.servoAngle = angle;
          });
          emitter.withHistory.on('plugin.cameraServo.targetPos',function(angle){
            self.targetAngle = angle;
          });
        }
      })
    })();
  </script>

</dom-module>
